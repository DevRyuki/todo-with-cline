# アクティブコンテキスト

## 現在の作業焦点
- Todo基本機能実装
- DBスキーマとAPIエンドポイント開発
- フィーチャーモジュール構造確立
- TDD実践とESLint連携
- 認証機能実装と改善
- フロントエンドコンポーネント開発
- テスト環境と型定義の改善
- E2Eテスト実装と拡充

## 最近の変更
- DBスキーマ定義（Drizzle）
- Todos CRUD API実装
- プロジェクト/ワークスペーススキーマ定義
- フィーチャーベース構造導入
- 認証バックエンド実装（NextAuth）
- パスワードリセット機能実装（Resend）
- 認証UI実装（ログイン/登録/リセット）
- コンポーネント適切分離
- モック型定義改善（jest.d.ts）
- TodoListコンポーネント実装
- コンポーネント/API統合テスト実装
- テスト用型定義ファイル作成
- E2Eテスト環境構築（Playwright）
- E2Eテスト実装
  - 認証関連テスト（サインイン/サインアップ/パスワードリセット）
  - Todoアプリ基本機能テスト（表示/完了状態切替）
  - テストデータベースリセット機能
- データフェッチング機能実装
  - Todoフェッチャー実装（APIとの通信）
  - Todoカスタムフック実装（useTodos）
  - エラーハンドリングとローディング状態管理
  - TodoListコンポーネントをカスタムフック使用に更新
- APIルートのインポートパス修正

## 進行中の作業
- フロントエンドUI開発
- プロジェクト/ワークスペースAPI実装
- テスト環境改善
- Todo管理UI実装
  - Todo作成・編集フォーム開発
  - フォームモーダル実装
- E2Eテスト拡充
  - 複雑なユーザーシナリオ追加
  - テストデータ自動生成改善
  - 並列テスト実行最適化

## 次のステップ
1. Todo作成・編集フォーム開発
   - 基本フォームコンポーネント実装
   - フォームバリデーション
   - モーダル統合
   - メインページ更新
2. Todoリスト機能の拡張（フィルタリング、ソート）
3. プロジェクト管理機能実装
4. ワークスペース管理機能実装
5. E2Eテスト拡充
   - Todo作成・編集テスト
   - プロジェクト/ワークスペース管理テスト
   - ユーザーフロー完全テスト
   - CI/CD連携

## アクティブな決定事項
- **TDD**: テスト→実装→リファクタリングサイクル
- **フィーチャーベース構造**: 機能ごとのコード整理
- **Drizzle ORM**: 型安全SQLクエリビルダー
- **Next.js App Router**: ルーティング/API統合
- **コンポーネント分離**: UI/データ/ロジック分離
- **NextAuth**: 認証システム
- **Resend**: メール送信
- **テスト戦略**: 単体テスト、統合テスト、コンポーネントテスト、E2Eテストの組み合わせ
- **E2Eテスト**: Playwrightを使用したブラウザテスト
- **UIコンポーネント**: Shadcn/UIを使用したコンポーネントライブラリ

## 現在の課題
- DBリレーションシップ最適設計
- パフォーマンス最適化
- スケーラビリティ確保
- テスト型エラー解消
- テスト実行時のエラー解消
  - コンポーネントテスト: JSX構文エラー（Jest設定の問題）
  - ハンドラーテスト: Next.js環境設定エラー
- 認証セキュリティ強化
  - パスワード強度ポリシー
  - ユーザー列挙攻撃対策
- コンポーネントとAPIの連携テスト拡充
- E2Eテスト環境の安定性向上
  - テストデータの一貫性確保
  - テスト間の独立性維持
  - テスト実行速度の最適化

## 検討中の代替案
- 状態管理: Context vs Redux vs Zustand
- フォーム: React Hook Form vs Formik

## 重要なメモ
- APIパターン: `/api/[resource]`
- フィーチャーモジュールは独立開発可能に
- UIはレスポンシブ設計
- 認証API:
  - `/api/auth/[...nextauth]`
  - `/api/auth/register`
  - `/api/auth/forgot-password`
  - `/api/auth/reset-password`
- モック型定義は`jest.d.ts`で管理
- パスワードは独立テーブルで管理
- E2Eテスト:
  - Playwrightフレームワーク使用
  - `npm run test:e2e`でテスト実行
  - `npm run test:e2e:ui`でUI表示モード
  - `npm run test:e2e:debug`でデバッグモード
  - テスト前にデータベースリセット（`tests/helpers/setup-db.ts`）
  - グローバルセットアップ（`tests/global-setup.ts`）
  - テストデータ自動生成
  - データテスト属性（`data-testid`）を使用したセレクタ
